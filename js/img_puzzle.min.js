function img_pzl(e){function t(e,t){return Math.random()*(t-e)+e}function o(e){if(!1!==T)for(let t=0;t<e.length;t++)e[t].addEventListener("mousedown",function(o){o.preventDefault(),!1!==T&&(S=this.offsetLeft,q=this.offsetTop,A=o.pageX,I=o.pageY,this.addEventListener("mousemove",n),this.addEventListener("mouseleave",n),_.addEventListener("mouseup",function(){e[t].removeEventListener("mousemove",n),e[t].removeEventListener("mouseleave",n)}),_.addEventListener("mouseleave",function(){e[t].style.top=E[t]+"px",e[t].style.left=L[t]+"px",e[t].removeEventListener("mousemove",n),e[t].removeEventListener("mouseleave",n),e[t].style.zIndex="1"}))}),e[t].addEventListener("touchstart",function(o){if(o.preventDefault(),!1===T)return;S=this.offsetLeft,q=this.offsetTop;let n=o.touches;A=n[0].pageX,I=n[0].pageY,this.addEventListener("touchmove",i),_.addEventListener("touchend",function(o){o.preventDefault(),e[t].removeEventListener("touchmove",i)})})}function n(e){this.style.left=S+e.pageX-A+"px",this.style.top=q+e.pageY-I+"px"}function i(e){var t=e.touches;this.style.left=S+t[0].pageX-A+"px",this.style.top=q+t[0].pageY-I+"px"}function r(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,o)=>e===t[o])}try{if("object"!=typeof e)throw"An object must be passed to the function! Now it is: "+typeof e}catch(e){return void console.error("img_pzl : "+e)}let s=e.image,l=e.holder,a=e.difficulty||"medium",f=e.delay||3e3,u=e.shuffle||1,p=e.transition,m=e.shadow,c=e.hintSwap,d=img_pzl.onShuffle,g=img_pzl.onShuffleEnd,h=img_pzl.gameOver;try{if("string"!=typeof s&&!Array.isArray(s))throw"images expecting to be a string or an array, "+typeof s+" given";if("string"!=typeof l)throw"holder expecting to be a string, "+typeof l+" given";if("number"!=typeof p&&void 0!==p)throw"transition expecting to be a number, "+typeof p+" given";if(!document.querySelector(l))throw'holder ( " '+l+' " ) cannot be found';if("function"!=typeof h&&void 0!==h)throw"img_pzl.gameOver expecting to be a function, "+typeof h+" given";if("number"!=typeof f)throw"delay expecting to be a number, "+typeof f+" given";if("number"!=typeof u)throw"shuffle expecting to be a number, "+typeof u+" given";if("string"!=typeof m&&void 0!==m)throw"shadow expecting to be a string, "+typeof m+" given";if("string"!=typeof a)throw"difficulty expecting to be a string, "+typeof a+" given";if("easy"!==a&&"medium"!==a&&"hard"!==a&&"nightmare"!==a)throw"difficulty can be easy, medium, hard or nightmare";if("function"!=typeof d&&void 0!==d)throw"onShuffle expecting to be a function, "+typeof d+" given";if("function"!=typeof g&&void 0!==g)throw"onShuffleEnd expecting to be a function, "+typeof g+" given";if("boolean"!=typeof c&&void 0!==c)throw"hintSwap expecting to be a boolean, "+typeof c+" given";if(0==document.querySelector(l).offsetHeight||0==document.querySelector(l).offsetWidth)throw"The main holder's ( "+l+" ) width or height has been set to 0. It cannot be seen"}catch(e){return void console.error("img_pzl : "+e+"!")}void 0===img_pzl.gameOver&&(img_pzl.gameOver=function(){let e=img_pzl.gameOver.results.moves,t=img_pzl.gameOver.results.time_formatted.minutes,o=img_pzl.gameOver.results.time_formatted.seconds,n=img_pzl.gameOver.results.played_difficulty;alert("You win! You did it in "+e+" moves and "+t+" minute(s) and "+o+" seconds. The difficulty was "+n)}),void 0===m&&(m="inset 1px 1px 3px #ccc"),void 0===c&&(c=!0),void 0===p&&(p=300);let y,v,_,b=0,x=0,w="",z="",L=[],E=[];transition_s=p/1e3,transition_ms=p;let S,q,A,I,M=new Image,T=!1;if(M.onerror=function(){console.error("img_pzl : Image could not be loaded")},M.onload=function(){function e(e,t){D=Math.round(A*Y/e)*e,X=Math.round(I*Y/t)*t,j=e*t-1,w=X/t,z=D/e}function n(e){if(!1!==T){if("mousedown"===e.type||"touchstart"===e.type){for(let e=0;e<N.length;e++)N[e].style.transition="all 0s";e.target.style.zIndex="2",0===b&&(y=new Date)}if("touchend"===e.type||"mouseup"===e.type){for(let e=0;e<N.length;e++)N[e].style.transition="all "+transition_s+"s";let t,o,n=_.getBoundingClientRect(),r=n.left,l=n.top,a=[];"mouseup"===e.type&&(t=e.clientX,o=e.clientY,a.push(t-r,o-l)),"touchend"===e.type&&(t=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,a.push(t-r,o-l));for(let t=0;t<N.length;t++)if(N[t]!==e.target||t===N.length-1){if(a[0]>N[t].offsetLeft&&a[0]<N[t].offsetLeft+z&&a[1]>N[t].offsetTop&&a[1]<N[t].offsetTop+w){s(i(e.target),t);break}t==N.length-1&&(e.target.style.top=E[i(e.target)]+"px",e.target.style.left=L[i(e.target)]+"px",x++)}e.target.style.zIndex="1",q()}}}function i(e){for(let t=0;t<N.length;t++)if(N[t]===e)return t}function s(e,t){let o=parseInt(e),n=parseInt(t),i=N[o].getAttribute("data-sequence");N[o].setAttribute("data-sequence",N[n].getAttribute("data-sequence")),N[n].setAttribute("data-sequence",i),i=E[o],E[o]=E[n],E[n]=i,N[o].style.top=E[o]+"px",N[n].style.top=E[n]+"px",i=L[o],L[o]=L[n],L[n]=i,N[o].style.left=L[o]+"px",N[n].style.left=L[n]+"px",!0===T&&(y||(y=new Date),p(),b++)}function p(){let e=[];for(let t=0;t<N.length;t++)e.push(parseInt(N[t].getAttribute("data-sequence"))),t===N.length-1&&(r(B,e)?(T=!1,setTimeout(function(){img_pzl.state(!0)},transition_ms+1)):e=[])}function h(e){for(let t=0;t<N.length;t++)N[t].style.boxShadow=e}function S(){d&&img_pzl.onShuffle();for(let e=0;e<N.length;e++)N[e].style.transition="all "+transition_s+"s";let e,t=N.length;for(;0!==t;)e=Math.floor(Math.random()*t),t--,s(t,e)}function q(){!1!==T&&(T=!1,setTimeout(function(){T=!0},transition_ms))}let A=M.width,I=M.height,O=document.querySelector(l).offsetHeight,k=document.querySelector(l).offsetWidth,Y=Math.min(k/A,O/I),D=0,X=0,C=0,H=0,j=0;switch(a){case"easy":C=5,H=2;break;case"medium":C=7,H=2;break;case"hard":C=7,H=3;break;case"nightmare":C=8,H=4}if(e(C,H),document.querySelectorAll(l+" ._game_output .bg-elem")){let e=document.querySelectorAll(l+" ._game_output .bg-elem");for(let t=0;t<e.length;t++)e[t].removeEventListener("touchstart",n),e[t].removeEventListener("mousedown",n),e[t].removeEventListener("touchend",n),e[t].removeEventListener("mouseup",n)}let W=document.querySelector(l);for(;W.firstChild;)W.removeChild(W.firstChild);img_pzl.oldHolder===l&&clearTimeout(img_pzl.wait),img_pzl.oldHolder=l,_=document.createElement("DIV"),_.classList.add("_game_output"),document.querySelector(l).appendChild(_),_=document.querySelector("._game_output"),_.style.position="absolute",_.style.width=D+"px",_.style.height=X+"px",_.style.left="50%",_.style.marginLeft=-D/2+"px",_.style.overflow="hidden";let B=[];for(let e=0;e<=j;e++){let o=Math.floor(t(0,100));if(B.includes(o)){let e=!0;for(;!0===e;)o=Math.floor(t(0,100)),e=!!B.includes(o)}B.push(o),_.innerHTML+="<div data-sequence="+B[e]+" class='bg-elem'></div>\n"}const N=document.querySelectorAll(l+" ._game_output .bg-elem");img_pzl.elements=N;let P,R=0,V=0;for(let e=0;e<N.length;e++){N[e].style.position="absolute",N[e].style.backgroundImage="url('"+M.src+"')",N[e].style.backgroundSize=D+"px "+X+"px",N[e].style.height=w+"px",N[e].style.width=z+"px",N[e].style.left=z*V+"px",0===R?(N[e].style.top="0px",V++):(N[e].style.top=w*R+"px",V++),V===C&&(V=0,R++);let t=N[e].offsetLeft,o=N[e].offsetTop;N[e].style.backgroundPosition=-t+"px "+-o+"px",L.push(t),E.push(o)}for(let e=0;e<N.length;e++)N[e].addEventListener("touchstart",n),N[e].addEventListener("mousedown",n),N[e].addEventListener("touchend",n),N[e].addEventListener("mouseup",n);img_pzl.mark=function(){let e=[];for(let t=0;t<N.length;t++){let o=parseInt(N[t].getAttribute("data-sequence"));o===B[t]&&e.push(t)}return e},img_pzl.hint=function(){let e=[];if(!1===T)return;let t,o=!1;for(;!1===o;){t=Math.floor(Math.random()*B.length);let n=parseInt(N[t].getAttribute("data-sequence"));if(B[t]!==n){for(let o=0;o<N.length;o++)parseInt(N[o].getAttribute("data-sequence"))===B[t]&&(c&&s(o,t),e.push(o),e.push(t));return o=!0,e}}},img_pzl.state=function(e=!1){if(!y)return!1;v=new Date;let t=v-y,o={minutes:Math.floor(t/1e3/60),seconds:Math.floor(t/1e3%60)},n={moves:b,cancelled_moves:x,time_ms:t,time_s:Math.floor(t/1e3),time_m:t/1e3/60,time_formatted:o,total_shuffle:u,played_difficulty:a};if(!0!==e)return n;if(img_pzl.gameOver.results=n,img_pzl.gameOver(),y=!1,T=!1,m)for(let e=0;e<N.length;e++)N[e].style.boxShadow="inset 0 0 0 transparent"},img_pzl.wait=setTimeout(function(){let e=1;P=setInterval(function(){if(e===u)return clearInterval(P),T=!0,h(m),o(N),void(g&&g());e++,S()},transition_ms+1),S()},f)},Array.isArray(s)){let e=Math.floor(t(0,s.length-1));M.src=s[e],img_pzl.img=M.src}"string"==typeof s&&(M.src=s,img_pzl.img=M.src)}