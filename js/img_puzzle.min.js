function img_pzl(e){function t(){console.error("img_pzl : Image could not be loaded")}function o(e,t){return Math.random()*(t-e)+e}function n(e){if(!1!==L)for(let t=0;t<e.length;t++)e[t].addEventListener("mousedown",function(o){o.preventDefault(),!1!==L&&(z=this.offsetLeft,S=this.offsetTop,E=o.pageX,T=o.pageY,this.addEventListener("mousemove",i),this.addEventListener("mouseleave",i),q.addEventListener("mouseup",function(){e[t].removeEventListener("mousemove",i),e[t].removeEventListener("mouseleave",i)}))}),e[t].addEventListener("touchstart",function(o){if(o.preventDefault(),!1===L)return;z=this.offsetLeft,S=this.offsetTop;let n=o.touches;E=n[0].pageX,T=n[0].pageY,this.addEventListener("touchmove",l),q.addEventListener("touchend",function(o){o.preventDefault(),e[t].removeEventListener("touchmove",l)})})}function i(e){this.style.left=z+e.pageX-E+"px",this.style.top=S+e.pageY-T+"px"}function l(e){var t=e.touches;this.style.left=z+t[0].pageX-E+"px",this.style.top=S+t[0].pageY-T+"px"}try{if("object"!=typeof e)throw"An object must be passed to the function! Now it is: "+typeof e}catch(e){return void console.error("img_pzl : "+e)}let r=e.image,s=e.holder,f=e.difficulty||"normal",u=e.delay||3e3,a=e.shuffle||50,p=e.shadow,c=e.animation||!1,d=img_pzl.onShuffle,g=img_pzl.onShuffleEnd,h=img_pzl.gameOver;try{if("string"!=typeof r&&!Array.isArray(r))throw"images expecting to be a string or an array, "+typeof r+" given";if("string"!=typeof s)throw"holder expecting to be a string, "+typeof s+" given";if(!document.querySelector(s))throw'holder ( " '+s+' " ) cannot be found';if("function"!=typeof h&&void 0!==h)throw"img_pzl.gameOver expecting to be a function, "+typeof h+" given";if("number"!=typeof u)throw"delay expecting to be a number, "+typeof u+" given";if("number"!=typeof a)throw"shuffle expecting to be a number, "+typeof a+" given";if("string"!=typeof p&&void 0!==p)throw"shadow expecting to be a string, "+typeof p+" given";if("string"!=typeof f)throw"difficulty expecting to be a string, "+typeof f+" given";if("easy"!==f&&"normal"!==f&&"hard"!==f&&"nightmare"!==f)throw"difficulty can be easy, normal, hard or nightmare";if("function"!=typeof d&&void 0!==d)throw"onShuffle expecting to be a function, "+typeof d+" given";if("function"!=typeof g&&void 0!==g)throw"onShuffleEnd expecting to be a function, "+typeof g+" given";if("boolean"!=typeof c)throw"animation expecting to be a boolean, "+typeof c+" given";if(0==document.querySelector(s).offsetHeight||0==document.querySelector(s).offsetWidth)throw"The main holder's ( "+s+" ) width or height has been set to 0. It cannot be seen."}catch(e){return void console.error("img_pzl : "+e+"!")}void 0===img_pzl.gameOver&&(img_pzl.gameOver=function(){let e=img_pzl.gameOver.results.moves,t=img_pzl.gameOver.results.time_formatted.minutes,o=img_pzl.gameOver.results.time_formatted.seconds,n=img_pzl.gameOver.results.played_difficulty;alert("You win! You did it in "+e+" moves and "+t+" minute(s) and "+o+" seconds. The difficulty was "+n)}),void 0===p&&(p=!1);let m,y,v=0,x=0,_="",b="",w=new Image,L=!1;w.onerror=t;let z,S,E,T,q="";if(w.onload=function(){function e(e,t){Y=Math.round(A*I/e)*e,D=Math.round(M*I/t)*t,H=e*t-1,_=D/t,b=Y/e}function t(e){if(!1===L)return;let t=document.querySelectorAll(s+" ._game_output ."+e.target.classList);if("mousedown"===e.type||"touchstart"===e.type){for(let e=0;e<t.length;e++)t[e].style.transition="all 0s";R.push(e.target.offsetTop),R.push(e.target.offsetLeft),e.target.style.zIndex="2",0===v&&(m=new Date)}if("touchend"===e.type||"mouseup"===e.type){for(let e=0;e<t.length;e++)t[e].style.transition="all 0.3s";let o,n,l=q.getBoundingClientRect(),r=l.left,s=l.top,f=[];"mouseup"===e.type&&(o=e.clientX,n=e.clientY,f.push(o-r,n-s)),"touchend"===e.type&&(o=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,f.push(o-r,n-s));for(let o=0;o<t.length;o++)if(t[o]!==e.target||o===t.length-1){if(f[0]>t[o].offsetLeft&&f[0]<t[o].offsetLeft+b&&f[1]>t[o].offsetTop&&f[1]<t[o].offsetTop+_){i(e.target,t[o]),v++;break}o==t.length-1&&(e.target.style.top=R[0]+"px",e.target.style.left=R[1]+"px",R=[],x++)}e.target.style.zIndex="1",S()}}function i(e,t){let o=e.getAttribute("data-sequence"),n=t.getAttribute("data-sequence");e.setAttribute("data-sequence",n),t.setAttribute("data-sequence",o),e.style.left=t.offsetLeft+"px",e.style.top=t.offsetTop+"px",t.style.top=R[0]+"px",t.style.left=R[1]+"px",R=[],!0===L&&setTimeout(function(){l()},350)}function l(){for(let e=0;e<V.length;e++){let t=V[e].getAttribute("data-sequence");T+=t,e===V.length-1&&(T===E?(L=!1,img_pzl.state(!0)):T="")}}function r(e){if(e)if("default"===e)for(let e=0;e<V.length;e++)V[e].style.boxShadow="inset 1px 1px 3px #ccc";else for(let t=0;t<V.length;t++)V[t].style.boxShadow=e}function h(){d&&img_pzl.onShuffle();let e=document.querySelectorAll(s+" ._game_output .bg-elem");for(let t=0;t<a;t++){let o=Math.floor(Math.random()*e.length),l=Math.floor(Math.random()*e.length);R.push(e[o].offsetTop),R.push(e[o].offsetLeft),i(e[o],e[l]),t==a-1&&(!0===c?z():(L=!0,r(p),n(V),g&&img_pzl.onShuffleEnd()))}}function z(){let e=[],t=[];for(let o=0;o<V.length;o++)e.push(V[o].offsetTop),t.push(V[o].offsetLeft);let o=D/2-_/2,i=Y/2-b/2;for(let e=0;e<V.length;e++)V[e].style.top=o+"px",V[e].style.left=i+"px";N.style.top=o+"px",N.style.left=i+"px",N.style.width=b+"px",N.style.height=_+"px",N.style.backgroundPosition="-"+i+"px -"+o+"px",setTimeout(function(){for(let e=0;e<V.length;e++)V[e].style.transition="all 0.3s";for(let o=0;o<V.length;o++)setTimeout(function(){V[o].style.top=e[o]+"px",V[o].style.left=t[o]+"px"},100*o),o===V.length-1&&setTimeout(function(){L=!0,r(p),n(V),g&&setTimeout(function(){img_pzl.onShuffleEnd()},301)},1+100*o);N.remove()},400)}function S(){!1!==L&&(L=!1,setTimeout(function(){L=!0},310))}img_pzl.img=w.src;let E="",T="",A=w.width,M=w.height,O=document.querySelector(s).offsetHeight,k=document.querySelector(s).offsetWidth,I=Math.min(k/A,O/M),Y=0,D=0,C=0,X=0,H=0;if("easy"===f&&(C=5,X=2),"normal"===f&&(C=7,X=2),"hard"===f&&(C=7,X=3),"nightmare"===f&&(C=8,X=4),e(C,X),document.querySelectorAll(s+" ._game_output .bg-elem")){let e=document.querySelectorAll(s+" ._game_output .bg-elem");for(let o=0;o<e.length;o++)e[o].removeEventListener("touchstart",t),e[o].removeEventListener("mousedown",t),e[o].removeEventListener("touchend",t),e[o].removeEventListener("mouseup",t)}let j=document.querySelector(s);for(;j.firstChild;)j.removeChild(j.firstChild);img_pzl.holder===s&&clearTimeout(img_pzl.wait),img_pzl.holder=s;let P=document.createElement("DIV");P.classList.add("_game_output"),document.querySelector(s).appendChild(P),q=document.querySelector("._game_output"),q.style.overflow="hidden";for(let e=0;e<=H;e++){let e=Math.floor(o(0,H-1));q.innerHTML+="<div data-sequence="+e+" class='bg-elem'></div>\n"}q.style.position="absolute",q.style.width=Y+"px",q.style.height=D+"px",q.style.left="50%",q.style.marginLeft=-Y/2+"px";let V=document.querySelectorAll(s+" ._game_output .bg-elem"),W=0,B=0;for(let e=0;e<V.length;e++){let t=V[e].getAttribute("data-sequence");E+=t,V[e].style.position="absolute",V[e].style.backgroundImage="url('"+w.src+"')",V[e].style.backgroundSize=Y+"px "+D+"px",V[e].style.height=_+"px",V[e].style.width=b+"px",V[e].style.left=b*B+"px",0===W?(V[e].style.top="0px",B++):(V[e].style.top=_*W+"px",B++),B===C&&(B=0,W++);let o=V[e].offsetLeft,n=V[e].offsetTop;V[e].style.backgroundPosition=-o+"px "+-n+"px"}let N="";if(!0===c){let e=document.createElement("DIV");e.classList.add("overlay_div"),q.appendChild(e),N=document.querySelector(".overlay_div"),N.setAttribute("style","position: relative;width: 100%;height: 100%;left: 0px;top: 0px;background-image: url('"+w.src+"');background-size: "+Y+"px "+D+"px;background-position: -"+N.offsetLeft+"px -"+N.offsetTop+"px;z-index: 3;transition: all .3s linear;")}let R=[];for(let e=0;e<V.length;e++)V[e].addEventListener("touchstart",t),V[e].addEventListener("mousedown",t),V[e].addEventListener("touchend",t),V[e].addEventListener("mouseup",t);img_pzl.state=function(e=!1){if(!m)return!1;y=new Date;let t=y-m,o={minutes:Math.floor(t/1e3/60),seconds:Math.floor(t/1e3%60)},n={moves:v,cancelled_moves:x,time_ms:t,time_s:Math.floor(t/1e3),time_m:t/1e3/60,time_formatted:o,total_shuffle:a,played_difficulty:f};if(!0!==e)return n;if(img_pzl.gameOver.results=n,img_pzl.gameOver(),m=!1,p)for(let e=0;e<V.length;e++)V[e].style.boxShadow="inset 0px 0px 0px #ccc"},img_pzl.wait=setTimeout(h,u)},Array.isArray(r)){let e=Math.floor(o(0,r.length-1));w.src=r[e]}"string"==typeof r&&(w.src=r)}